[tox]
requires =
	tox>=4.28
	tox-uv>=1.28
env_list =
	pre-commit
	py{310,311,312}
	lint
	coverage
	type-check
skip_missing_interpreters = true

[testenv]
description = run unit tests with coverage
package = wheel
wheel_build_env = .pkg
deps =
	pytest>=8.4.1
	pytest-cov>=6.2.1
commands =
	pytest -q --cov=src/mcp_architecton --cov-report=term-missing:skip-covered --cov-report=xml:coverage.xml {posargs}

[testenv:lint]
description = run ruff lint checks
skip_install = true
deps =
	ruff>=0.12.9
commands =
	ruff check . {posargs}
	ruff format --check . {posargs}

[testenv:lint-fix]
description = run ruff lint with auto-fixes
skip_install = true
deps =
	ruff>=0.12.9
commands =
	ruff check --fix . {posargs}
	ruff format . {posargs}

[testenv:type-check]
description = run type checking with mypy
skip_install = false
deps =
	mypy>=1.8.0
	types-requests
commands =
	mypy src/mcp_architecton {posargs}

[testenv:coverage]
description = run coverage report
deps =
	pytest>=8.4.1
	pytest-cov>=6.2.1
commands =
	pytest --cov=src/mcp_architecton --cov-report=term-missing --cov-report=html --cov-fail-under=50

[testenv:pre-commit]
description = run full pre-commit suite (ruff, formatting, pyupgrade, hygiene)
skip_install = true
deps =
	pre-commit>=3.8.0
commands =
	pre-commit run --all-files --show-diff-on-failure
